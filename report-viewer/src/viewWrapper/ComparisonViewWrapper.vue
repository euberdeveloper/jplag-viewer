<template>
  <ComparisonView
    v-if="comparison && language"
    :first-id="firstId"
    :second-id="secondId"
    :comparison="comparison"
    :language="language"
  />
  <div
    v-else
    class="absolute bottom-0 left-0 right-0 top-0 flex flex-col items-center justify-center"
  >
    <LoadingCircle class="mx-auto" />
  </div>
</template>

<script setup lang="ts">
import { type Ref, ref } from 'vue'
import { OverviewFactory } from '@/model/factories/OverviewFactory'
import ComparisonView from '@/views/ComparisonView.vue'
import { getHighlightLanguage, type HighlightLanguage } from '@/model/Language'
import type { Comparison } from '@/model/Comparison'
import { ComparisonFactory } from '@/model/factories/ComparisonFactory'
import LoadingCircle from '@/components/LoadingCircle.vue'

const props = defineProps({
  firstId: {
    type: String,
    required: true
  },
  secondId: {
    type: String,
    required: true
  }
})

const comparison: Ref<Comparison | null> = ref(null)
const language: Ref<HighlightLanguage | null> = ref(null)

// This eslint rule is disabled to allow the use of await in the setup function. Disabling this rule is safe, because the props are gathered from the url, so changing them would reload the pafe anyway.
// eslint-disable-next-line vue/no-setup-props-reactivity-loss
ComparisonFactory.getComparison(props.firstId, props.secondId).then((comp) => {
  comparison.value = comp
})

OverviewFactory.getOverview().then((overview) => {
  language.value = getHighlightLanguage(overview.language)
})
</script>
